<!doctype html>
<!DOCTYPE html>
<html ondragstart="return false" onselectstart="return false">
    <head>
        <meta charset="UTF-8" />
        <title>3D档案库</title>
        <link rel="stylesheet" href="css/index.css" />
    </head>
    <body>

        <div id="all">
            <!--主屏显示-->
            <div id="main">
                <!--所有li模块-->
                <div id="list">
                    <ul></ul>
                </div>

                <!--左下角按钮-->
                <div id="btn">
                    <ul>
						<li id="gridBtn">Grid</li>
						<li id="helixBtn">Helix</li>
						<li id="SphereBtn">Sphere</li>
						<li id="" onclick="fullScreen()">fullScreen</li>
						<li id="" onclick="exitScreen()">exitScreen</li>
						<li onclick="triggar()">trigger</li>
                    </ul>
                </div>
            </div>
		</div>
		
		<div id="alert_box">

			
		</div>
    </body>
    <script src="js/data.js"></script>
    <script>
		var img_list = [ "img/1.jpg" , "img/2.png" , "img/3.jpg" , "img/4.jpg" , "img/5.png" , "img/6.png"]
		var is_rotate = true
		/*------model object init------*/
		var oImg = new Image()
		oImg.src = "img/1.jpg"
		oImg.onload = function(){
			var oUL = document.getElementById('list').children[0]
			while(oImg.width > 250){
				oImg.width = oImg.width / 1.5
				oImg.height = oImg.height / 1.5
			}
			oUL.style.width = oImg.width + "px"
			oUL.style.height = oImg.height + "px"
		}

     	function Magic(){
     		this.liNum = 125;
			this.oUl = document.getElementById('list').children[0];
			this.aLi = this.oUl.children;
			this.disX = 350;
			this.disY = 350;
			this.disZ = 600;
			this.oUlZ = -2000;
			this.rotateX = 0;
			this.rotateY = 0;
     	}
     	
     	Magic.prototype.init = function(){//创建li元素
     		var fragment = document.createDocumentFragment();//使用文档片段 轻量级
     		for(var i=0;i<this.liNum;i++){
     			var oLi = document.createElement('li');
				var data = flyData[0];
				var index = Math.floor(Math.random() * img_list.length)
				var img_src = img_list[ index ]
				oLi.style.backgroundImage = `url('${img_src}')`
				oLi.style.backgroundSize = "100% 100%"
     			// oLi.innerHTML = //"<b class='liCover'></b>"+
				//      			"<p class='liTitle'>"+data.type+"</p>"+
				//      			"<p class='liAuthor'>"+data.author+"</p>"+
				//      			"<p class='liTime'>"+data.time+"</p>"
				fragment.appendChild(oLi);
     		}
     		this.oUl.appendChild(fragment);//避免直接的DOM插入
     		
     	}
     	
     	Magic.prototype.grid = function(){
     		
     		for(var i = 0;i < this.liNum;i++){
     			this.aLi[i].index = i;	// 保存排序
       			this.aLi[i].x = i % 5;	// 确定元素的位置(排列位置)
       			this.aLi[i].y = ~~(i % 25 / 5);
       			this.aLi[i].z = 4 - ~~(i / 25);
       			this.aLi[i].pox = (this.aLi[i].x - 2)*this.disX,//设置元素的位置（空间位置）
       			this.aLi[i].poy = (this.aLi[i].y - 2)*this.disY,
       			this.aLi[i].poz = (this.aLi[i].z - 3)*this.disZ + 500;
       			this.aLi[i].style.transform = "translate3D("+this.aLi[i].pox+"px,"+this.aLi[i].poy+"px,"+this.aLi[i].poz+"px)";
     		}
     	}
     	
     	Magic.prototype.helix = function(){
     		for(var i = 0;i < this.liNum;i++){
     			this.aLi[i].pox = 0;
     			this.aLi[i].poy = ~~(i%25/5)*200-400;
     			this.aLi[i].poz = 1250;
     			this.aLi[i].rotateY = 2*i*(360/125);//360/25
     			this.aLi[i].style.transform = "rotateY("+this.aLi[i].rotateY+"deg)"+
     			"translate3D("+this.aLi[i].pox+"px,"+this.aLi[i].poy+"px,1250px)";
     		}
     	}
     	
     	Magic.prototype.sphere = function(){
     		for(var i = 0;i < this.liNum;i++){
     			this.aLi[i].pox = 0;
     			this.aLi[i].poy = ~~(i%25/5)*200-600;
     			this.aLi[i].poz = 1000;
     			this.aLi[i].rotateY = 3*i*(360/125);//360/25
     			this.aLi[i].rotateX = ~~(i%25/5)*36-80;//绕X轴转的度数
     			this.aLi[i].style.transform = "rotateY("+this.aLi[i].rotateY+"deg) rotateX("+this.aLi[i].rotateX+"deg)"+
     			"translate3D("+this.aLi[i].pox+"px,"+this.aLi[i].poy+"px,1000px)";
     		}
     	}
     	
     	document.addEventListener('mousewheel',function(event){
			// console.log(magic.oUlZ)
			if(magic.oUlZ < -3000){
				magic.oUlZ = -2999
				return
			}else if(magic.oUlZ > 800){
				magic.oUlZ = 799
				return
			}
     		if (!event) event = window.event;
     		var delta = 0;
		  
		    if (event.wheelDelta) {//IE、chrome浏览器使用的是wheelDelta，并且值为“正负120”
		        delta = event.wheelDelta/120; 
		        if (window.opera) delta = -delta;//因为IE、chrome等向下滚动是负值，FF是正值，为了处理一致性，在此取反处理
		    } else if (event.detail) {//FF浏览器使用的是detail,其值为“正负3”
		        delta = -event.detail/3;
		    }
     		magic.oUlZ -= delta*400;
     		magic.oUl.style.transform = "translate3D(0px,0px,"+magic.oUlZ+
     									"px) rotateX("+magic.rotateX+
     									"deg) rotateY("+magic.rotateY+"deg)";
		 })//end of mousewheel
     	
     	document.onmousedown=function(event){
     		if (!event) event = window.event;
     		var x = event.clientX,
     			y = event.clientY,
     			cutX = x,
     			cuty= y;
     		document.onmousemove = function(event){
     			if (!event) event = window.event;
     			cutX = event.clientX - x;
     			cutY = event.clientY - y;
     			magic.rotateX += -cutY*.02;
     			magic.rotateY += cutX*.02;
   				magic.oUl.style.transform = "translate3D(0px,0px,"+magic.oUlZ+
   											"px) rotateX("+magic.rotateX+
   											"deg) rotateY("+magic.rotateY+"deg)";
     		}
     		document.onmouseup = function(){
     			document.onmousemove = null;
     		}	
		}//end of document.onmousedown

		document.ontouchstart = function(event){
			if (!event) event = window.event;
     		var x = event.changedTouches[0].clientX,
     			y = event.changedTouches[0].clientY,
     			cutX = x,
				cuty= y;
			document.ontouchmove = function(event){
				if (!event) event = window.event;
     			cutX = event.changedTouches[0].clientX - x;
     			cutY = event.changedTouches[0].clientY - y;
     			magic.rotateX += -cutY*.02;
     			magic.rotateY += cutX*.02;
   				magic.oUl.style.transform = "translate3D(0px,0px,"+magic.oUlZ+
   											"px) rotateX("+magic.rotateX+
   											"deg) rotateY("+magic.rotateY+"deg)";
			}
			document.ontouchend = function(){
				document.ontouchmove = null
			}
		}

		var ainimate_timer
		var alert_box = document.getElementById("alert_box")
     	var magic = new Magic();
     	magic.init();//创建li元素
     	magic.grid();//默认为grid模式
     	var gridBtn = document.getElementById('gridBtn'),
     		helixBtn = document.getElementById('helixBtn'),
     		SphereBtn = document.getElementById('SphereBtn');
     	
     	gridBtn.onclick = function(){magic.grid();}
     	helixBtn.onclick = function(){magic.helix();}
     	SphereBtn.onclick = function(){magic.sphere();}
     	
     	magic.oUl.onclick = function(e){
			alert_box.style.width = "80%"
			alert_box.style.height = "80%"
			alert_box.style.top = "10%"
			alert_box.style.left = "10%"
			// alert_box.innerHTML = ""
			alert_box.innerHTML = `
				<img src="${ e.target.style.backgroundImage.split('"')[1] }"/>
				<p>${ flyData[e.target.index].type }</P>
				<p>${ flyData[e.target.index].author }</P>
				<p>${ flyData[e.target.index].time }</P>
				<div id="btn">
					<ul>
						<li class="close" onclick="close_alert()">close</li>
					</ul>
				</div>
			`
		}
		function close_alert(){
			alert_box.style.width = "0"
			alert_box.style.height = "0"
			alert_box.style.top = "50%"
			alert_box.style.left = "50%"
		}
		// animate
		rotate_scene()
		function rotate_scene(){
			// magic.oUlZ += 0.05
			// magic.rotateX += 0.05
			magic.rotateY += 0.05
			magic.oUl.style.transform = "translate3D(0px,0px,"+magic.oUlZ+
   											"px) rotateX("+magic.rotateX+
   											"deg) rotateY("+magic.rotateY+"deg)";
			ainimate_timer = requestAnimationFrame(rotate_scene)
		} 
		 
		//全屏
		function fullScreen(){
            var el = document.documentElement;
            var rfs = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullscreen;      
                if(typeof rfs != "undefined" && rfs) {
                    rfs.call(el);
                };
              return;
        }
        //退出全屏
        function exitScreen(){
            if (document.exitFullscreen) {  
                document.exitFullscreen();  
            }  
            else if (document.mozCancelFullScreen) {  
                document.mozCancelFullScreen();  
            }  
            else if (document.webkitCancelFullScreen) {  
                document.webkitCancelFullScreen();  
            }  
            else if (document.msExitFullscreen) {  
                document.msExitFullscreen();  
            } 
            if(typeof cfs != "undefined" && cfs) {
                cfs.call(el);
            }
        }
		
		function triggar(){
			if(is_rotate){
				cancelAnimationFrame(ainimate_timer)
				is_rotate = !is_rotate
			}else{
				rotate_scene()
			}
		}
	</script>
</html>














